{% extends "base.html" %}
{% block content %}
<div class="card" id="tour-hero">
  <div class="section-head">
    <div>
      <div class="section-label" style="margin-bottom:1.5rem;">
        <div class="section-label-dot"></div>
        <span class="section-label-text">MirÃ« se erdhe</span>
      </div>
      <h1 class="gradient-text">{{ user.firstName }}, nis veprimin sot</h1>
      <p class="muted" style="font-size:1rem;">Krijo thirrje, apliko pÃ«r tÃ« ndihmuar, ndiq pikÃ«t dhe mos humb asnjÃ« status tÃ« rÃ«ndÃ«sishÃ«m.</p>
    </div>
    <div class="pill" style="margin-left:auto;">Shqip â€¢ Me ritÃ«m</div>
  </div>
  <div class="stats">
    <div class="stat">
      <div class="pill">ğŸ† PikÃ«</div>
      <h2 style="color:var(--accent); margin:0.5rem 0;">{{ rewards.points|default:0 }}</h2>
      <p class="muted">BesueshmÃ«ria</p>
    </div>
    <div class="stat">
      <div class="pill">âœ“ PÃ«rfunduar</div>
      <h2 style="color:var(--accent); margin:0.5rem 0;">{{ rewards.completedRequests|default:0 }}</h2>
      <p class="muted">Si vullnetar</p>
    </div>
    <div class="stat">
      <div class="pill">â­ VlerÃ«sim</div>
      <h2 style="color:var(--accent); margin:0.5rem 0;">{{ rewards.averageRating|default:"0"|floatformat:1 }}/5</h2>
      <p class="muted">{{ rewards.reviewCount|default:0 }} vlerÃ«sime</p>
    </div>
  </div>
  <div class="quick-grid" id="tour-shortcuts">
    <a class="quick-card" href="/requests/">
      <p class="eyebrow" style="color:var(--accent); font-weight:700;">PRONARI</p>
      <h3 style="color:var(--foreground);">Krijo / Menaxho</h3>
      <p class="muted">Ngarko foto, pÃ«rshkrim, kontakto vullnetarÃ«.</p>
    </a>
    <a class="quick-card" href="/requests/?tab=open#active-requests">
      <p class="eyebrow" style="color:var(--accent); font-weight:700;">VULLNETAR</p>
      <h3 style="color:var(--foreground);">Shfleto thirrje</h3>
      <p class="muted">Apliko shpejt dhe ndiq statusin.</p>
    </a>
    <a class="quick-card" href="/applications/">
      <p class="eyebrow" style="color:var(--accent); font-weight:700;">STATUSET</p>
      <h3 style="color:var(--foreground);">Aplikimet e mia</h3>
      <p class="muted">Pranime, refuzime, nÃ« pritje.</p>
    </a>
    <a class="quick-card" href="/profile/">
      <p class="eyebrow" style="color:var(--accent); font-weight:700;">PROFILI</p>
      <h3 style="color:var(--foreground);">PÃ«rditÃ«so</h3>
      <p class="muted">Avatar, bio, aftÃ«si, distinktivÃ«.</p>
    </a>
    {% if user.role == "ADMIN" %}
    <a class="quick-card" href="/admin-dashboard/">
      <p class="eyebrow">Admin</p>
      <h3>Paneli i adminit</h3>
      <p class="muted">PÃ«rdorues, blog, statistika.</p>
    </a>
    {% endif %}
  </div>
</div>

<div class="dashboard-lower">
  <div class="card" id="tour-notifs">
    <div class="section-head">
      <div>
      <p class="eyebrow">Njoftime & veprime</p>
        <h3>Shih Ã§farÃ« ka ndryshuar sÃ« fundi</h3>
      </div>
      <a class="pill link" href="/applications/">Shko te aplikimet</a>
    </div>
    <div class="notification-list">
      {% for n in notifications %}
        <div class="notification-row">
          <div>
            <p class="muted" style="margin:0;">{{ n.type }}</p>
            <strong><a href="{{ n.link }}">{{ n.title }}</a></strong>
            <div class="chip-row">
              <span class="status-pill" data-status="{{ n.status|default:'UNKNOWN' }}">{{ n.status|default:'â€”' }}</span>
            </div>
          </div>
          <a class="pill" href="{{ n.link }}">Shko</a>
        </div>
      {% empty %}
        <p class="muted">AsnjÃ« njoftim. Apliko ose krijo njÃ« thirrje pÃ«r tÃ« parÃ« ndryshimet.</p>
      {% endfor %}
    </div>
  </div>

  <div class="card" id="tour-leaderboard">
    <h3>ğŸ† Leaderboard i vullnetarÃ«ve</h3>
      <p class="muted">Top 5 sipas pikÃ«ve</p>
    <div class="leader-header">
      <span>Vullnetari</span>
      <span>Statistikat</span>
      <span>PikÃ«</span>
    </div>
    <div class="leaderboard">
      {% for p in leaderboard %}
        <div class="leader-row rank-{{ forloop.counter }}">
          <div class="leader-rank rank-{{ forloop.counter }}">
            {% if forloop.counter == 1 %}ğŸ¥‡{% elif forloop.counter == 2 %}ğŸ¥ˆ{% elif forloop.counter == 3 %}ğŸ¥‰{% else %}{{ forloop.counter }}{% endif %}
          </div>
          <div class="leader-info">
            <strong><a href="/profiles/{{ p.id }}/">{{ p.firstName }} {{ p.lastName }}</a></strong>
            <div class="leader-stats">
              <span class="leader-chip">âœ… {{ p.completedRequests|default:0 }} thirrje</span>
              <span class="leader-chip">â­ {{ p.averageRating|default:"0"|floatformat:1 }}/5</span>
              <span class="leader-chip">ğŸ’¬ {{ p.reviewCount|default:0 }} vlerÃ«sime</span>
            </div>
          </div>
          <div class="leader-points">
            <span class="pill">{{ p.rewardPoints|default:0 }} pikÃ«</span>
            <span class="rank-change up">â†‘</span>
          </div>
        </div>
      {% empty %}
        <div class="empty-state">
          <span class="empty-state-icon">ğŸ“Š</span>
          <h3>Ende s'ka pikÃ«</h3>
          <p class="muted">Apliko ose krijo thirrje pÃ«r ta parÃ« leaderboard-in.</p>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<div class="tour-popover" id="dashboard-tour" style="display:none;">
  <div class="tour-inner">
    <p class="eyebrow">Tur i shpejtÃ«</p>
    <h4>3 pika pÃ«r t'u nisur</h4>
    <ol>
      <li>Paneli i mÃ«sipÃ«rm ka shkurtesat kryesore (krijo thirrje, aplikime, profil).</li>
      <li>Njoftimet kÃ«tu tregojnÃ« statuset e aplikimeve dhe thirrjeve tÃ« tua.</li>
      <li>Leaderboard-i tÃ« ndihmon tÃ« shohÃ«sh motivimin dhe distinktivÃ«t e komunitetit.</li>
    </ol>
    <div class="actions">
      <button type="button" class="ghost-btn" id="tour-hide">Mbyll</button>
      <button type="button" id="tour-done">E kuptova</button>
    </div>
  </div>
</div>
<script>
  (function(){
    const seenKey = 'vullnet_dashboard_tour_seen';
    const tour = document.getElementById('dashboard-tour');
    if (!tour) return;
    if (!localStorage.getItem(seenKey)) {
      tour.style.display = 'block';
    }
    const hide = () => { tour.style.display = 'none'; localStorage.setItem(seenKey, '1'); };
    document.getElementById('tour-hide')?.addEventListener('click', hide);
    document.getElementById('tour-done')?.addEventListener('click', hide);
  })();
</script>
{% endblock %}
