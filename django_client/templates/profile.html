{% extends "base.html" %}
{% block content %}
<div style="max-width:1000px; margin:2rem auto; padding:0 2rem;">
  <!-- Header Section -->
  <div style="background:linear-gradient(135deg, var(--foreground) 0%, #0a0f1f 100%); color:white; border-radius:28px; padding:3rem 2rem; margin-bottom:3rem; position:relative; overflow:hidden;">
    <div style="position:absolute; top:0; left:0; right:0; bottom:0; background-image:radial-gradient(circle at 1rem 1rem, white 1px, transparent 1px); background-size:4rem 4rem; opacity:0.05; pointer-events:none;"></div>
    <div style="position:relative; z-index:1; display:flex; gap:2rem; align-items:flex-start;">
      <!-- Avatar with Upload -->
      <div style="flex-shrink:0; position:relative; group;">
        {% if profile.avatarUrl %}
          <img src="{{ profile.avatarUrl }}" alt="Avatar" style="width:100px; height:100px; border-radius:20px; border:3px solid rgba(0, 82, 255, 0.6); object-fit:cover;">
        {% else %}
          <img src="https://api.dicebear.com/7.x/fun-emoji/svg?seed={{ profile.id }}" alt="Avatar" style="width:100px; height:100px; border-radius:20px; border:3px solid rgba(0, 82, 255, 0.6); object-fit:cover; display:block; background:white;">
        {% endif %}
        <label for="avatar_upload_header" style="position:absolute; bottom:0; right:0; background:var(--accent); color:white; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:1rem; border:2px solid white; transition:all 0.2s ease;">
          âœ
        </label>
        <input type="file" id="avatar_upload_header" name="avatar_file" accept="image/*" form="profile_form" style="display:none;" onchange="document.getElementById('avatar_form_submit').click();">
      </div>
      <!-- Profile Info -->
      <div style="flex:1;">
        <p style="font-size:0.85rem; color:rgba(255, 255, 255, 0.8); margin:0 0 0.5rem; text-transform:uppercase; letter-spacing:0.05em; font-weight:600;">Profili im</p>
        <h1 style="font-family:var(--font-display); font-size:2rem; color:white; margin:0 0 0.5rem; font-weight:700;">{{ profile.firstName|default:"AnÃ«tar" }} {{ profile.lastName|default:"" }}</h1>
        <p style="color:rgba(255, 255, 255, 0.9); margin:0 0 1rem; font-size:1.05rem;">
          {% if profile.location %}<strong>ğŸ“ {{ profile.location }}</strong>{% endif %}
          {% if profile.availability %}<span style="margin-left:1rem;"> ğŸŸ¢ Gati pÃ«r tÃ« ndihmuar</span>{% else %}<span style="margin-left:1rem;"> âš« Jo nÃ« dispozicion</span>{% endif %}
        </p>
        <!-- Stats Row -->
        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:1rem; margin-top:1.5rem;">
          <div>
            <p style="color:rgba(255, 255, 255, 0.7); font-size:0.85rem; margin:0; text-transform:uppercase;">PikÃ«</p>
            <p style="font-size:1.8rem; color:var(--accent); margin:0.25rem 0 0; font-weight:700;">{{ profile.rewardPoints|default:0 }}</p>
          </div>
          <div>
            <p style="color:rgba(255, 255, 255, 0.7); font-size:0.85rem; margin:0; text-transform:uppercase;">VlerÃ«simi</p>
            <p style="font-size:1.8rem; color:var(--accent); margin:0.25rem 0 0; font-weight:700;">{{ profile.averageRating|default:"0"|floatformat:1 }}/5</p>
          </div>
          <div>
            <p style="color:rgba(255, 255, 255, 0.7); font-size:0.85rem; margin:0; text-transform:uppercase;">PÃ«rfunduar</p>
            <p style="font-size:1.8rem; color:var(--accent); margin:0.25rem 0 0; font-weight:700;">{{ profile.completedRequests|default:0 }}</p>
          </div>
        </div>
      </div>
      <!-- Actions -->
      <div style="display:flex; flex-direction:column; gap:0.5rem;">
        <a href="/profiles/{{ profile.id }}/" class="pill" style="padding:0.5rem 1.2rem; background:rgba(0, 82, 255, 0.2); color:white; border:1px solid rgba(0, 82, 255, 0.5); border-radius:20px; text-decoration:none; text-align:center; font-size:0.85rem; font-weight:600;">Shiko profilin publik â†’</a>
      </div>
    </div>
  </div>

  <!-- Two Column Layout -->
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:2rem; margin-bottom:3rem;">
    <!-- Edit Form Column -->
    <div style="background:var(--card); border:2px solid var(--accent); border-radius:28px; padding:2rem;">
      <div style="margin-bottom:2rem; padding-bottom:1.5rem; border-bottom:1px solid rgba(0, 0, 0, 0.1);">
        <p style="color:var(--accent); font-size:0.85rem; margin:0 0 0.5rem; text-transform:uppercase; font-weight:600;">PÃ«rditÃ«so</p>
        <h2 style="font-family:var(--font-display); font-size:1.5rem; color:var(--foreground); margin:0;">PÃ«rditÃ«so profilin</h2>
      </div>

      <form method="post" enctype="multipart/form-data" style="display:flex; flex-direction:column; gap:1.5rem;" id="profile_form">
        {% csrf_token %}
        <button type="submit" id="avatar_form_submit" style="display:none;"></button>

        <!-- Bio -->
        <div style="display:flex; flex-direction:column; gap:0.5rem;">
          <label style="font-weight:600; color:var(--foreground); font-size:0.95rem;">Bio</label>
          {{ form.bio }}
          <p style="font-size:0.85rem; color:rgba(0, 0, 0, 0.6); margin:0;">Shkruaj diÃ§ka pÃ«r veten dhe pÃ«rvojat e tua</p>
        </div>

        <!-- Location & Phone -->
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem;">
          <div style="display:flex; flex-direction:column; gap:0.5rem;">
            <label style="font-weight:600; color:var(--foreground); font-size:0.95rem;">Vendndodhja</label>
            {{ form.location }}
          </div>
          <div style="display:flex; flex-direction:column; gap:0.5rem;">
            <label style="font-weight:600; color:var(--foreground); font-size:0.95rem;">Telefon</label>
            {{ form.phone }}
          </div>
        </div>

        <!-- Skills -->
        <div style="display:flex; flex-direction:column; gap:0.5rem;">
          <label style="font-weight:600; color:var(--foreground); font-size:0.95rem;">AftÃ«sitÃ«</label>
          {{ form.skills }}
          <p style="font-size:0.85rem; color:rgba(0, 0, 0, 0.6); margin:0;">Ndaje me presje: koordinim, logjistikÃ«, mjekÃ«si</p>
        </div>

        <!-- Checkboxes -->
        <div style="display:flex; flex-direction:column; gap:1rem; padding-top:1rem; border-top:1px solid rgba(0, 0, 0, 0.1);">
          <label style="display:flex; align-items:center; gap:0.75rem; cursor:pointer;">
            {{ form.availability }}
            <span style="color:var(--foreground); font-weight:500;">Jam gati tÃ« pranoj thirrje</span>
          </label>
          <label style="display:flex; align-items:center; gap:0.75rem; cursor:pointer;">
            {{ form.profilePublic }}
            <span style="color:var(--foreground); font-weight:500;">BÃ«j profilin tim publik</span>
          </label>
        </div>

        <!-- Submit -->
        <button type="submit" class="btn-primary" style="padding:0.875rem 1.5rem; font-size:1rem; font-weight:600; margin-top:1rem;">
          Ruaj ndryshimet
        </button>
      </form>

      <!-- Input Styling -->
      <style>
        form input[type="text"],
        form input[type="email"],
        form input[type="phone"],
        form textarea,
        form select,
        form input[type="file"],
        form input[type="checkbox"] {
          padding: 0.75rem;
          border: 1.5px solid rgba(0, 82, 255, 0.2);
          border-radius: 12px;
          font-size: 0.95rem;
          font-family: var(--font-body);
          background: rgba(0, 82, 255, 0.02);
          color: var(--foreground);
          transition: all 0.2s ease;
          box-sizing: border-box;
          width: 100%;
        }
        
        form input[type="text"]:focus,
        form input[type="email"]:focus,
        form input[type="phone"]:focus,
        form textarea:focus,
        form select:focus,
        form input[type="file"]:focus {
          outline: none !important;
          border-color: var(--accent) !important;
          background: rgba(0, 82, 255, 0.05) !important;
          box-shadow: 0 0 0 3px rgba(0, 82, 255, 0.08) !important;
        }

        form textarea {
          resize: vertical;
          min-height: 80px;
        }

        form input[type="checkbox"] {
          width: auto;
          cursor: pointer;
        }
      </style>
    </div>

    <!-- Preview Column -->
    {% if profile %}
    <div class="profile-preview-card">
      <div class="profile-preview-head">
        <p class="profile-preview-kicker">Paraqitje</p>
        <h2>Si tÃ« shohin tÃ« tjerÃ«t</h2>
      </div>

      <div class="profile-preview-body">
        <div class="profile-preview-section">
          <p class="profile-preview-label">Bio</p>
          <p class="profile-preview-text">{{ profile.bio|default:"Shto diÃ§ka pÃ«r veten, pÃ«rvojÃ«n dhe motivimin." }}</p>
        </div>

        <div class="profile-preview-grid">
          <div class="profile-preview-tile">
            <p class="profile-preview-label">ğŸ“ Vendndodhja</p>
            <p class="profile-preview-value">{{ profile.location|default:"â€”" }}</p>
          </div>
          <div class="profile-preview-tile">
            <p class="profile-preview-label">ğŸ“ Telefon</p>
            <p class="profile-preview-value">{{ profile.phone|default:"â€”" }}</p>
          </div>
        </div>

        <div class="profile-preview-section">
          <p class="profile-preview-label">ğŸ§© AftÃ«sitÃ«</p>
          <div class="profile-preview-pills">
            {% if skills_list %}
              {% for skill in skills_list %}
                <span class="profile-preview-pill">{{ skill }}</span>
              {% endfor %}
            {% else %}
              <span class="profile-preview-muted">Shto aftÃ«sitÃ« nÃ« formÃ«n mÃ« sipÃ«r</span>
            {% endif %}
          </div>
        </div>

        <div class="profile-preview-section">
          <p class="profile-preview-label">DistinktivÃ«</p>
          <div class="profile-preview-pills">
            {% if profile.badges %}
              {% for b in profile.badges %}
                <span class="profile-preview-badge">{{ b }}</span>
              {% endfor %}
            {% else %}
              <span class="profile-preview-muted">Fitohen me kontribut</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}
